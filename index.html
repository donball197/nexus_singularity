<!DOCTYPE html>
<html>
<head>
    <title>NEXUS HUD</title>
    <style>
        body { background: #020617; color: #38bdf8; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .card { border: 2px double #38bdf8; padding: 1.5rem; border-radius: 8px; background: #0f172a; box-shadow: 0 0 20px #0ea5e9; width: 90%; max-width: 600px; height: 85vh; display: flex; flex-direction: column; transition: opacity 0.3s ease; }
        h1 { color: #f8fafc; border-bottom: 1px solid #334155; padding-bottom: 10px; letter-spacing: 2px; font-size: 1.1rem; margin: 0; }
        .metric-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .label { color: #94a3b8; font-size: 0.75rem; }
        .value { color: #7dd3fc; font-size: 0.9rem; font-weight: bold; text-align: right; }
        #neural-log { flex-grow: 1; overflow-y: auto; background: #020617; border: 1px solid #1e293b; padding: 10px; font-size: 0.85rem; display: flex; flex-direction: column-reverse; }
        .log-entry { margin-bottom: 8px; border-left: 2px solid #0ea5e9; padding-left: 8px; }
        .thought { color: #22c55e; text-shadow: 0 0 5px #16a34a; }
        .sentinel-msg { color: #facc15; font-weight: bold; }
        .status-bar { color: #e2e8f0; font-weight: bold; margin-top: 15px; border-top: 1px solid #334155; padding-top: 10px; font-size: 0.85rem; }
    </style>
    <script>
        let lastThought = "";
        const glyphs = "ABCDEF0123456789$#@%&*<>?/";

        async function update() {
            try {
                const res = await fetch('/stats');
                const data = await res.json();
                
                const card = document.querySelector('.card');
                if (data.is_stealth) {
                    card.style.opacity = "0";
                    card.style.pointerEvents = "none";
                } else {
                    card.style.opacity = "1";
                    card.style.pointerEvents = "auto";
                }

                document.getElementById('stat-status').innerText = data.status;
                document.getElementById('stat-command').innerText = data.last_command;
                document.getElementById('stat-battery').innerText = data.battery;

                if (data.status !== lastThought) {
                    if (data.status.startsWith("SENTINEL:")) {
                        addEntry(data.status, "sentinel-msg");
                    } else if (data.status.startsWith("GEMMA:")) {
                        decryptLogEntry(data.status.replace("GEMMA: ", ""));
                    }
                    lastThought = data.status;
                }
            } catch (e) { console.log("Link_Error"); }
        }

        function addEntry(text, className) {
            const log = document.getElementById('neural-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            entry.innerHTML = `<span class="timestamp">[${time}]</span><span class="${className}">${text}</span>`;
            log.prepend(entry);
        }

        function decryptLogEntry(text) {
            const log = document.getElementById('neural-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const thoughtSpan = document.createElement('span');
            thoughtSpan.className = 'thought';
            entry.appendChild(thoughtSpan);
            log.prepend(entry);

            let i = 0;
            const interval = setInterval(() => {
                thoughtSpan.innerText = text.split("").map((c, idx) => {
                    if (idx < i) return text[idx];
                    return glyphs[Math.floor(Math.random() * glyphs.length)];
                }).join("");
                if (i >= text.length) clearInterval(interval);
                i += 1/3;
            }, 30);
        }
        setInterval(update, 1500);
    </script>
</head>
<body>
    <div class="card">
        <h1>>> NEXUS_SINGULARITY_V0.3.5</h1>
        <div class="metric-box">
            <div class="label">BATTERY:</div><div class="value" id="stat-battery">...</div>
            <div class="label">CMD:</div><div class="value" id="stat-command">...</div>
        </div>
        <div id="neural-log"></div>
        <div class="status-bar" id="stat-status">INIT...</div>
    </div>
</body>
</html>
